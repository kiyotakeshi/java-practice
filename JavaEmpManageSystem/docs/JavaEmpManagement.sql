### 全体像

- テーブルの構造

mysql> show tables;
+------------------------+
| Tables_in_FinalSubject |
+------------------------+
| company_info           |
| employee_info          |
| employee_state         |
| login_info             |
+------------------------+
4 rows in set (0.00 sec)


- 最終的に使用するSQL

SELECT * FROM employee_state AS es \
join employee_info AS ei ON (es.employee_info_id = ei.employee_id) \
LEFT JOIN company_info AS ci ON (ei.company_info_id = ci.company_id);

---
### 単体でテーブルを検索

- employee_stateのテーブルのみ

mysql> SELECT * FROM employee_state AS es;
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+
| employee_info_id | enter_date | retire_date | status | is_deleted | created             | modified            | created_id | modified_id |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+
|                1 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                2 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                3 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                4 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+
4 rows in set (0.00 sec)

---
- employee_infoのテーブルのみ

mysql> SELECT * FROM employee_info AS ei;
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
| employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
|           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0001    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|           2 | エルバ太郎       | えるばたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0001    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|           3 | インフ太郎       | いんふたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0001    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|           4 | 管太郎           | かんたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0001    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
4 rows in set (0.00 sec)

---
- company_infoのテーブルのみ

mysql> SELECT * FROM company_info AS ci;
+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
| company_id | company_name                                  | abbreviation | is_deleted | created             | modified            | created_id | modified_id |
+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
|          1 | アクシス                              | AX          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|          3 | クラウド                            | CL          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
3 rows in set (0.00 sec)

---
###  結合してみる

- テーブル結合
	- employee_info_id が外部キー

mysql> SELECT * FROM employee_state AS es \
    -> join employee_info AS ei ON (es.employee_info_id = ei.employee_id);

+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
| employee_info_id | enter_date | retire_date | status | is_deleted | created             | modified            | created_id | modified_id | employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
|                1 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|                2 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           2 | エル太郎       | えるばくたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|                3 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           3 | インフラ太郎       | いんふらたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
|                4 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           4 | 管太郎           | かんりたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+
4 rows in set (0.01 sec)

---
- JOIN と LEFT JOIN の違い
    - JOIN は内部結合(2つのテーブルで一致した行のデータだけを取得する結合方式)
    - LEFT JOIN は外部結合(2つのテーブルをくっつけて大きなテーブルを作成)
    - LEFT JOIN はONより左側のカラムの長さが優先される

mysql> SELECT * FROM employee_info AS ei \
    -> LEFT JOIN company_info AS ci ON (ei.company_info_id = ci.company_id);
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
| employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            | company_id | company_name                                  | abbreviation | is_deleted | created             | modified            | created_id | modified_id |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
|           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          1 | アクシス                              | AX          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           3 | インフラ太郎       | いんふらたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           4 | 管太郎           | かんりたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           2 | エル太郎       | えるばくたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          3 | クラウド                            | CL          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
4 rows in set (0.00 sec)


mysql> SELECT * FROM employee_info AS ei \
    -> JOIN company_info AS ci ON (ei.company_info_id = ci.company_id);
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
| employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            | company_id | company_name                                  | abbreviation | is_deleted | created             | modified            | created_id | modified_id |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
|           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          1 | アクシス                              | AX          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           3 | インフラ太郎       | いんふらたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           4 | 管太郎           | かんりたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|           2 | エル太郎       | えるばくたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          3 | クラウド                            | CL          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
4 rows in set (0.00 sec)


---
### 最終的な結合結果

mysql> SELECT * FROM employee_state AS es \
    -> join employee_info AS ei ON (es.employee_info_id = ei.employee_id) \
    -> LEFT JOIN company_info AS ci ON (ei.company_info_id = ci.company_id);
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
| employee_info_id | enter_date | retire_date | status | is_deleted | created             | modified            | created_id | modified_id | employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            | company_id | company_name                                  | abbreviation | is_deleted | created             | modified            | created_id | modified_id |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
|                1 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          1 | アクシス                              | AX          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                3 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           3 | インフラ太郎       | いんふらたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                4 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           4 | 管太郎           | かんりたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                2 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           2 | エル太郎       | えるばくたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          3 | クラウド                            | CL          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
4 rows in set (0.01 sec)

- やっぱり JOIN と LEFT JOIN の結果は同じ？
    - 今回は結合するテーブルが1対1の関係(両方のテーブルに共通の値がある)ため同じ結果
    - むしろ片側のテーブルにしか存在しないデータを作ることを防ぐため外部結合を使わない方がいいケース

mysql> SELECT * FROM employee_state AS es \
    -> join employee_info AS ei ON (es.employee_info_id = ei.employee_id) \
    -> JOIN company_info AS ci ON (ei.company_info_id = ci.company_id);
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
| employee_info_id | enter_date | retire_date | status | is_deleted | created             | modified            | created_id | modified_id | employee_id | name               | name_hiragana         | birthday   | sex  | mail_address    | telephone_number | company_info_id | business_manager | department | commissioning_status | is_deleted | created_id | modified_id | created             | modified            | company_id | company_name                                  | abbreviation | is_deleted | created             | modified            | created_id | modified_id |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
|                1 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           1 | 碓太郎           | うすたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               1 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          1 | アクシス                              | AX          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                3 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           3 | インフラ太郎       | いんふらたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 1          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                4 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           4 | 管太郎           | かんたろう          | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               2 | 田社長         | 4          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          2 | インフラストラクチャー                | IF          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
|                2 | 2018-06-18 | NULL        | 0      | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |           2 | エル太郎       | えるたろう        | 1995-09-28 | 0    | testshi@mhko.co | 080-0000-0000    |               3 | 田社長         | 0          | 0                    | 0          | test       | java        | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 |          3 | クラウド                            | CL          | 0          | 2019-08-01 14:32:12 | 2019-08-01 14:32:12 | test       | java        |
+------------------+------------+-------------+--------+------------+---------------------+---------------------+------------+-------------+-------------+--------------------+-----------------------+------------+------+-----------------+------------------+-----------------+------------------+------------+----------------------+------------+------------+-------------+---------------------+---------------------+------------+-----------------------------------------------+--------------+------------+---------------------+---------------------+------------+-------------+
4 rows in set (0.00 sec)


