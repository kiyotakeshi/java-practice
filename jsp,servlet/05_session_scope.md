### セッションスコープ

- リクエストスコープは保存したインスタンスがリクエストをまたげない(リクエストの終了とともに消滅)
- セッションスコープに保存されたインスタンスは利用者がブラウザを閉じるか明示的にインスタンスを削除するまで使用可能

- ユーザ登録機能の実装
    - http://localhost:8080/example/RegisterUser でアクセス

```
// User.java
// 登録するユーザを表すJavaBeansのモデル

```

```
// RegisterUserLogic.java
// ユーザ登録を行うモデル(ファイルやDB登録は行わない)

```

```
// RegisterUser.java
// ユーザ登録に関するリクエストを処理するコントローラー

```

```
// registerForm.jsp
// ユーザ登録入力画面を出力するビュー

```

```
// registerConfirm.jsp
// ユーザ登録確認画面を出力するビュー

```

```
// registerDone.jsp
// ユーザ登録完了画面を出力するビュー

```

```
// RegisterUser.java
// ユーザ登録に関数するリクエストを処理するコントローラ

```

---
### セッションスコープの補足

- セッションスコープの正体であるHttpSessionインスタンスはユーザ(ブラウザ)ごとに作成される

- APサーバがHttpSessionインスタンスを作成する(最初のgetSession()を実行)とセッションIDを発行
    - セッションIDをHttpSessionインスタンスとブラウザに設定することで両者を紐づける
    - リクエストの度に設定されたセッションIDを送信する
    - サーバがレスポンスにクッキーを含めることでレスポンスを受信したブラウザはクッキーにセッションIDを含める

- セッションスコープの多用はAPサーバのメモリ不足を引き起こす
    - HttpSessionインスタンスはすぐにガベージコレクションの対象にならないため
    - HttpSessionインスタンスが不要になったかはサーバは判断できない
    - セッションタイムアウトがくるとガベージコレクションの対象とする

- 短期間にリクエストが集中した際にはガベージコレクションが間に合わないことがあるため開発者が積極的にセッションスコープを管理する

- リクエストをまたいでユーザの情報を保持する通信を**ステートフル**な通信と呼ぶ
- リクエストをまたいで情報を保持できない通信を**ステートレス**な通信と呼ぶ
    - HTTPはステートレスなためセッションスコープやクッキーなどでステートフルを実現する
